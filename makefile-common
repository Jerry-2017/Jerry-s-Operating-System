.PHONY: ECHO

RM		:= rm

SUBDIRS := $(shell ls -l | grep ^d | awk '{if($$9 != "debug") print $$9}')

CFLAGS := -Wall -Werror -Wfatal-errors #å¼€å¯æ‰€æœ‰è­¦å‘? è§†è­¦å‘Šä¸ºé”™è¯¯, ç¬¬ä¸€ä¸ªé”™è¯¯ç»“æŸç¼–è¯?
CFLAGS += -std=gnu11 -m32 -c #ç¼–è¯‘æ ‡å‡†, ç›®æ ‡æ¶æ„, åªç¼–è¯?
CFLAGS += -I $(ROOT_DIR) #å¤´æ–‡ä»¶æœç´¢ç›®å½?
CFLAGS += -O0 #ä¸å¼€ä¼˜åŒ–, æ–¹ä¾¿è°ƒè¯•
CFLAGS += -fno-builtin #ç¦æ­¢å†…ç½®å‡½æ•°
CFLAGS += -ggdb3 #GDBè°ƒè¯•ä¿¡æ¯

SOURCES = $(wildcard *.c)
OBJS := $(patsubst %.c, %.o,$(SOURCES))
CC = gcc
MAKE = make
main: $(OBJS) $(SUBDIRS)
	@echo "source files:" $(SOURCES)
	@echo "object files:" $(OBJS)
	@#$(CC) $(OBJS)  -D$(MACRO) $(CFLAGS) -o main  

%d: %c
	@echo "create depend"
	$(CC) -MM $(CFLAGS) $< > $@.$$$$; \
	sed 's,\($*\)\.o[ :]*,\1.o $@ ,g' < $@.$$$$ > $@; \
	$(RM) $@.$$$$
sinclude $(SOURCES:.c=.d)
$(SUBDIRS):ECHO
	$(MAKE) -C $@
ECHO:
	@echo $(SUBDIRS)
